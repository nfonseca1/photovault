<% include partials/header.ejs %>

<script type="text/javascript" src="countries.js"></script>

<div id="data" data-searched="no"></div>
<h3 id="userData" data-user="<%=currentUser.username%>"><%=currentUser.username%>'s Account</h3>

<nav class="navbar navbar-expand-lg navbar-light bg-light" style="border: solid 1px #333333">
    <div class="navbar-nav">
        <a class="nav-item nav-link active" href="/account">Photos <span class="sr-only">(current)</span></a>
        <a class="nav-item nav-link" href="/account/following">Following</a>
        <a class="nav-item nav-link" href="/account/followers">Followers</a>
        <a class="nav-item nav-link" href="/account/messages">Messages</a>
        <a class="nav-item nav-link" href="/account/settings">Settings</a>
        <a class="nav-item nav-link" href="/logout">Logout</a>
    </div>
</nav>
<h3>Favorites</h3>

<label for="list">Filter by list: </label>
<select id="list" name="list" class="form-control">
    <option value="all" selected="selected">All Lists</option>
    <option value="">Unlisted</option>

</select>
<button type="button" id="filterBtn" class="btn btn-xs btn-primary">Filter</button>
<button type="button" id="toggleEditBtn" class="btn btn-xs btn-warning">Edit</button>

<nav class="navbar navbar-expand-lg navbar-light bg-light editListForm" style="border: solid 1px #333333; display: none">
    <div class="form-group">
        <label for="listName">List to add or edit: </label>
        <input type="text" id="listName">
    </div>
    <button type="button" class="btn btn-xs btn-success addBtn">Add list</button>
    <button type="button" class="btn btn-xs btn-warning editBtn">Change name</button>
    <button type="button" class="btn btn-xs btn-danger removeBtn">Remove list</button>
</nav>

<nav class="navbar navbar-expand-lg navbar-light bg-light" style="border: solid 1px #333333">
    <div class="form-group">
        <label for="sortBy">Sort By: </label>
        <select id="sortBy" name="sortBy" class="form-control">
            <option value="newest" selected="selected">Newest</option>
            <option value="highest rated">Highest Rated</option>
            <option value="most favorited">Most favorited</option>
            <option value="most viewed">Most Viewed</option>
        </select>
    </div>
    <div class="form-group col">
        <label for="within">Within: </label>
        <select id="within" name="within" class="form-control">
            <option value="day">Past Day</option>
            <option value="week">Past Week</option>
            <option value="month" selected="selected">Past Month</option>
            <option value="year">Past Year</option>
            <option value="ever">Ever</option>
        </select>
    </div>
    <div class="form-group col">
        <label for="photoType">PhotoType: </label>
        <select id="photoType" name="photoType" class="form-control">
            <option value="any" selected="selected">Any</option>
            <option value="landscapes">Landscapes</option>
            <option value="cityscapes">Cityscapes</option>
        </select>
    </div>
    <div class="form-group col">
        <label for="sortBy">Country: </label>
        <select id="country" name="country" class="form-control">
            <option value="all" selected="selected">All</option>
        </select>
    </div>
    <button id="sortBtn" class="btn btn-xs btn-primary">Sort</button>
</nav>

<div id="postsSection" class="text-center" data-index="<%=htmlPosts.index%>" style="display: flex; flex-wrap: wrap">
    <div id="column-1" class="col-md-4" data-col1="<%=htmlPosts.html1%>" style="padding: 2px 2px 0 2px">

    </div>
    <div id="column-2" class="col-md-4" data-col2="<%=htmlPosts.html2%>" style="padding: 0 5px 0 5px">

    </div>
    <div id="column-3" class="col-md-4" data-col3="<%=htmlPosts.html3%>" style="padding: 0 5px 0 5px">

    </div>
</div>
<div id="endOfPage"></div>

<script>
    sessionStorage.clear();
    var addButton = document.querySelector("#addButton");
    var addPhotoForm = document.querySelector("#addPhotoForm");
    var countriesList = document.querySelector("#countriesList");
    var addFormOn = false;

    addButton.addEventListener("click", openAddForm);

    function openAddForm(){
        addFormOn = !addFormOn;
        if (addFormOn){
            addPhotoForm.style.display = "block";
        } else {
            addPhotoForm.style.display = "none";
        }
    }
    var html = '';
    countries.forEach(function(country){
        if(country.name == "United States") {
            html += '<option value="' + country.name + '" selected="selected">' + country.name + '</option>';
        } else {
            html += '<option value="' + country.name + '">' + country.name + '</option>';
        }
    });
    countriesList.innerHTML = html;
</script>

<script type="text/javascript" src="postsSort.js"></script>
<script type="text/javascript" src="manageLists.js"></script>

<script>
    document.addEventListener("scroll", function() {
        checkForNewDiv();
    });

    var checkForNewDiv = function() {
        var lastDiv = document.querySelector("#endOfPage");
        var lastDivOffset = lastDiv.offsetTop;
        var pageOffset = window.pageYOffset + window.innerHeight;
        sessionStorage.pagePosition = window.pageYOffset;

        if(pageOffset > lastDivOffset - 150 && !end && !wait) {
            wait = true;
            makeAJAXRequest({}, true);
        }
    };
</script>

<% include partials/footer.ejs %>